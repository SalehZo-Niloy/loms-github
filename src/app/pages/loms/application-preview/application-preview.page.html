<app-loms-layout
  organisationName="Loan Origination and Management System"
  solutionName="LOMS"
  breadcrumb="Application Preview"
  basePath="/loms"
>
  <div class="space-y-6">
    <section class="rounded-xl border border-blue-100 bg-white p-6 shadow-sm">
      <div class="space-y-4">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h1 class="text-xl font-semibold text-slate-900">
              {{ title }}
            </h1>
            <p class="text-xs text-slate-500">
              Review all application details below. You can edit any section before confirming submission.
            </p>
          </div>
          <div class="flex flex-wrap items-center gap-2 text-[11px] text-slate-600">
            <span class="inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-0.5 text-emerald-700 border border-emerald-200">
              <span class="h-1.5 w-1.5 rounded-full bg-emerald-500"></span>
              Completed
            </span>
            <span class="inline-flex items-center gap-1 rounded-full bg-amber-50 px-2.5 py-0.5 text-amber-700 border border-amber-200">
              <span class="h-1.5 w-1.5 rounded-full bg-amber-400"></span>
              Draft
            </span>
            <span class="inline-flex items-center gap-1 rounded-full bg-red-50 px-2.5 py-0.5 text-red-700 border border-red-200">
              <span class="h-1.5 w-1.5 rounded-full bg-red-500"></span>
              Needs Attention
            </span>
          </div>
        </div>

        <nav
          class="mt-1 overflow-x-auto"
          aria-label="Loan application steps"
        >
          <div
            class="flex min-w-[520px] flex-wrap items-center gap-2 text-xs text-slate-600"
          >
            <button
              *ngFor="let stepTitle of stepTitles; let i = index"
              type="button"
              class="focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1 focus-visible:ring-offset-white"
              #stepButton
              [ngClass]="getStepCircleClasses(i)"
              [attr.aria-current]="currentStep === i ? 'step' : null"
              [attr.aria-label]="'Step ' + (i + 1) + ': ' + stepTitle"
              (click)="goToStep(i)"
              (keydown)="onStepKeydown($event, i)"
            >
              <span class="truncate">
                {{ stepTitle }}
              </span>
            </button>
          </div>
        </nav>
      </div>
    </section>

    <section class="rounded-xl border border-blue-100 bg-white p-6 shadow-sm">
      <div class="space-y-5">
        <div class="flex items-center justify-between gap-3 border-b border-blue-100 pb-3">
          <div class="flex items-center gap-2">
            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-blue-600 text-white text-xs">
              <span>01</span>
            </div>
            <div>
              <div class="text-sm font-semibold text-slate-900">
                Application Information
              </div>
              <div class="text-[11px] text-slate-600">
                Core application and customer context.
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span
              [ngClass]="getSectionStatusClasses(0)"
            >
              <span class="h-1.5 w-1.5 rounded-full"
                    [class.bg-emerald-500]="completedSteps.includes(0)"
                    [class.bg-amber-400]="!completedSteps.includes(0) && draftSteps.includes(0)"
                    [class.bg-red-500]="!completedSteps.includes(0) && !draftSteps.includes(0)"
              ></span>
              <span>{{ getSectionStatusLabel(0) }}</span>
            </span>
            <app-ui-button
              type="button"
              variant="secondary"
              (click)="onEditSection(0)"
            >
              Edit
            </app-ui-button>
          </div>
        </div>

        <div class="grid gap-4 md:grid-cols-2 text-xs text-slate-700">
          <div class="space-y-1.5">
            <div class="font-semibold text-slate-800">
              Customer & Application
            </div>
            <div class="grid grid-cols-[140px_minmax(0,1fr)] gap-y-1.5">
              <div class="text-slate-500">Existing Customer</div>
              <div class="font-medium">
                {{ loanData?.existingCustomer === 'yes' ? 'Yes' : loanData?.existingCustomer === 'no' ? 'No' : '--' }}
              </div>
              <div class="text-slate-500">Application Type</div>
              <div class="font-medium">
                {{ loanData?.applicationCheck || '--' }}
              </div>
              <div class="text-slate-500">Customer Type</div>
              <div class="font-medium">
                {{ loanData?.customerPointType || '--' }}
              </div>
              <div class="text-slate-500">Customer Name</div>
              <div class="font-medium">
                {{ loanData?.customerPointName || '--' }}
              </div>
              <div class="text-slate-500">Application Date</div>
              <div class="font-medium">
                {{ loanData?.applicationDate | date: 'mediumDate' }}
              </div>
            </div>
          </div>

          <div class="space-y-1.5">
            <div class="font-semibold text-slate-800">
              Proposal & Tracking
            </div>
            <div class="grid grid-cols-[140px_minmax(0,1fr)] gap-y-1.5">
              <div class="text-slate-500">Proposal Type</div>
              <div class="font-medium">
                {{ loanData?.proposalType || '--' }}
              </div>
              <div class="text-slate-500">Request Type</div>
              <div class="font-medium">
                {{ loanData?.requestType || '--' }}
              </div>
              <div class="text-slate-500">Assessment Type</div>
              <div class="font-medium">
                {{ loanData?.assessmentType || '--' }}
              </div>
              <div class="text-slate-500">Urgency</div>
              <div class="font-medium">
                {{ loanData?.urgencyStatus || '--' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-blue-100 bg-white p-6 shadow-sm">
      <div class="space-y-5">
        <div class="flex items-center justify-between gap-3 border-b border-blue-100 pb-3">
          <div class="flex items-center gap-2">
            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-blue-600 text-white text-xs">
              <span>02</span>
            </div>
            <div>
              <div class="text-sm font-semibold text-slate-900">
                Demographic Information
              </div>
              <div class="text-[11px] text-slate-600">
                Applicant personas and addresses.
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span
              [ngClass]="getSectionStatusClasses(1)"
            >
              <span class="h-1.5 w-1.5 rounded-full"
                    [class.bg-emerald-500]="completedSteps.includes(1)"
                    [class.bg-amber-400]="!completedSteps.includes(1) && draftSteps.includes(1)"
                    [class.bg-red-500]="!completedSteps.includes(1) && !draftSteps.includes(1)"
              ></span>
              <span>{{ getSectionStatusLabel(1) }}</span>
            </span>
            <app-ui-button
              type="button"
              variant="secondary"
              (click)="onEditSection(1)"
            >
              Edit
            </app-ui-button>
          </div>
        </div>

        <div class="space-y-4 text-xs text-slate-700">
          <div
            *ngFor="let persona of demographicData?.personas || []"
            class="rounded-xl border border-blue-100 bg-blue-50/40 p-3"
          >
            <div class="flex items-center justify-between gap-2 border-b border-blue-100 pb-2 mb-2">
              <div class="text-xs font-semibold text-slate-900">
                {{ persona.fullName || 'Unnamed Persona' }}
              </div>
              <div class="text-[11px] text-slate-500">
                {{ persona.personaType || 'Persona' }}
              </div>
            </div>
            <div class="grid gap-3 md:grid-cols-3">
              <div class="space-y-1">
                <div class="text-[11px] text-slate-500">Date of Birth</div>
                <div class="font-medium">
                  {{ persona.dateOfBirth | date: 'mediumDate' }}
                </div>
              </div>
              <div class="space-y-1">
                <div class="text-[11px] text-slate-500">Gender</div>
                <div class="font-medium">
                  {{ persona.gender || '--' }}
                </div>
              </div>
              <div class="space-y-1">
                <div class="text-[11px] text-slate-500">National ID</div>
                <div class="font-medium">
                  {{ persona.nationalId || '--' }}
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="!(demographicData?.personas?.length)">
            <div class="text-[11px] text-slate-500">
              No demographic personas captured yet.
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-blue-100 bg-white p-6 shadow-sm">
      <div class="space-y-5">
        <div class="flex items-center justify-between gap-3 border-b border-blue-100 pb-3">
          <div class="flex items-center gap-2">
            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-blue-600 text-white text-xs">
              <span>03</span>
            </div>
            <div>
              <div class="text-sm font-semibold text-slate-900">
                Product Information
              </div>
              <div class="text-[11px] text-slate-600">
                Loan product, amount and tenor.
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span
              [ngClass]="getSectionStatusClasses(2)"
            >
              <span class="h-1.5 w-1.5 rounded-full"
                    [class.bg-emerald-500]="completedSteps.includes(2)"
                    [class.bg-amber-400]="!completedSteps.includes(2) && draftSteps.includes(2)"
                    [class.bg-red-500]="!completedSteps.includes(2) && !draftSteps.includes(2)"
              ></span>
              <span>{{ getSectionStatusLabel(2) }}</span>
            </span>
            <app-ui-button
              type="button"
              variant="secondary"
              (click)="onEditSection(2)"
            >
              Edit
            </app-ui-button>
          </div>
        </div>

        <div class="grid gap-4 md:grid-cols-2 text-xs text-slate-700">
          <div class="space-y-1.5">
            <div class="font-semibold text-slate-800">
              Product Details
            </div>
            <div class="grid grid-cols-[140px_minmax(0,1fr)] gap-y-1.5">
              <div class="text-slate-500">Product Name</div>
              <div class="font-medium">
                {{ productData?.productName || '--' }}
              </div>
              <div class="text-slate-500">Loan Type</div>
              <div class="font-medium">
                {{ productData?.loanType || '--' }}
              </div>
              <div class="text-slate-500">Requested Amount</div>
              <div class="font-medium">
                {{ productData?.requestedAmount || '--' }}
              </div>
              <div class="text-slate-500">Tenor (Months)</div>
              <div class="font-medium">
                {{ productData?.tenorInMonths || '--' }}
              </div>
            </div>
          </div>

          <div class="space-y-1.5">
            <div class="font-semibold text-slate-800">
              Disbursement Details
            </div>
            <div class="grid grid-cols-[140px_minmax(0,1fr)] gap-y-1.5">
              <div class="text-slate-500">Disbursement Mode</div>
              <div class="font-medium">
                {{ productData?.disbursementMode || '--' }}
              </div>
              <div class="text-slate-500">Repayment Frequency</div>
              <div class="font-medium">
                {{ productData?.repaymentFrequency || '--' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-blue-100 bg-white p-6 shadow-sm">
      <div class="space-y-5">
        <div class="flex items-center justify-between gap-3 border-b border-blue-100 pb-3">
          <div class="flex items-center gap-2">
            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-blue-600 text-white text-xs">
              <span>04</span>
            </div>
            <div>
              <div class="text-sm font-semibold text-slate-900">
                Financial Information
              </div>
              <div class="text-[11px] text-slate-600">
                Employment and bank account details.
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span
              [ngClass]="getSectionStatusClasses(3)"
            >
              <span class="h-1.5 w-1.5 rounded-full"
                    [class.bg-emerald-500]="completedSteps.includes(3)"
                    [class.bg-amber-400]="!completedSteps.includes(3) && draftSteps.includes(3)"
                    [class.bg-red-500]="!completedSteps.includes(3) && !draftSteps.includes(3)"
              ></span>
              <span>{{ getSectionStatusLabel(3) }}</span>
            </span>
            <app-ui-button
              type="button"
              variant="secondary"
              (click)="onEditSection(3)"
            >
              Edit
            </app-ui-button>
          </div>
        </div>

        <div class="space-y-4 text-xs text-slate-700">
          <div class="grid gap-4 md:grid-cols-2">
            <div class="space-y-1.5">
              <div class="font-semibold text-slate-800">
                Employment
              </div>
              <div class="grid grid-cols-[140px_minmax(0,1fr)] gap-y-1.5">
                <div class="text-slate-500">Employment Type</div>
                <div class="font-medium">
                  {{ financialData?.employmentType || '--' }}
                </div>
                <div class="text-slate-500">Organization Name</div>
                <div class="font-medium">
                  {{ financialData?.organizationName || '--' }}
                </div>
              </div>
            </div>

            <div class="space-y-1.5">
              <div class="font-semibold text-slate-800">
                Income Summary
              </div>
              <div class="grid grid-cols-[140px_minmax(0,1fr)] gap-y-1.5">
                <div class="text-slate-500">Monthly Income</div>
                <div class="font-medium">
                  {{ financialData?.monthlyIncome || '--' }}
                </div>
                <div class="text-slate-500">Other Income</div>
                <div class="font-medium">
                  {{ financialData?.otherIncome || '--' }}
                </div>
              </div>
            </div>
          </div>

          <div>
            <div class="text-[11px] font-semibold text-slate-800 mb-2">
              Bank Accounts
            </div>
            <div class="overflow-x-auto rounded border border-blue-100 bg-blue-50/40">
              <table class="min-w-full border-collapse text-[11px] text-slate-700">
                <thead>
                  <tr class="border-b border-blue-100 bg-blue-50/80 text-slate-600">
                    <th class="px-3 py-2 text-left font-medium whitespace-nowrap">Account Number</th>
                    <th class="px-3 py-2 text-left font-medium whitespace-nowrap">Account Name</th>
                    <th class="px-3 py-2 text-left font-medium whitespace-nowrap">Bank Name</th>
                    <th class="px-3 py-2 text-left font-medium whitespace-nowrap">Account Type</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let account of financialData?.bankAccounts || []"
                    class="border-b border-blue-50 bg-white"
                  >
                    <td class="px-3 py-1.5 align-top">
                      {{ account.accountNumber || '--' }}
                    </td>
                    <td class="px-3 py-1.5 align-top">
                      {{ account.accountName || '--' }}
                    </td>
                    <td class="px-3 py-1.5 align-top">
                      {{ account.bankName || '--' }}
                    </td>
                    <td class="px-3 py-1.5 align-top">
                      {{ account.accountType || '--' }}
                    </td>
                  </tr>
                  <tr *ngIf="!(financialData?.bankAccounts?.length)">
                    <td
                      class="px-3 py-2 text-slate-500"
                      colspan="4"
                    >
                      No bank accounts captured yet.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-blue-100 bg-white p-6 shadow-sm">
      <div class="space-y-5">
        <div class="flex items-center justify-between gap-3 border-b border-blue-100 pb-3">
          <div class="flex items-center gap-2">
            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-blue-600 text-white text-xs">
              <span>05</span>
            </div>
            <div>
              <div class="text-sm font-semibold text-slate-900">
                Security Information
              </div>
              <div class="text-[11px] text-slate-600">
                Collateral and security details supporting the loan.
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span
              [ngClass]="getSectionStatusClasses(4)"
            >
              <span class="h-1.5 w-1.5 rounded-full"
                    [class.bg-emerald-500]="completedSteps.includes(4)"
                    [class.bg-amber-400]="!completedSteps.includes(4) && draftSteps.includes(4)"
                    [class.bg-red-500]="!completedSteps.includes(4) && !draftSteps.includes(4)"
              ></span>
              <span>{{ getSectionStatusLabel(4) }}</span>
            </span>
            <app-ui-button
              type="button"
              variant="secondary"
              (click)="onEditSection(4)"
            >
              Edit
            </app-ui-button>
          </div>
        </div>

        <div class="space-y-4 text-xs text-slate-700">
          <div
            *ngFor="let security of securityData?.securities || []"
            class="rounded-xl border border-blue-100 bg-blue-50/40 p-3"
          >
            <div class="flex items-center justify-between gap-2 border-b border-blue-100 pb-2 mb-2">
              <div class="text-xs font-semibold text-slate-900">
                {{ security.securityType || 'Security' }}
              </div>
              <div class="text-[11px] text-slate-500">
                {{ security.securityOwnership || '--' }}
              </div>
            </div>
            <div class="grid gap-3 md:grid-cols-3">
              <div class="space-y-1">
                <div class="text-[11px] text-slate-500">Property Type</div>
                <div class="font-medium">
                  {{ security.propertyType || '--' }}
                </div>
              </div>
              <div class="space-y-1">
                <div class="text-[11px] text-slate-500">Market Value</div>
                <div class="font-medium">
                  {{ security.marketValue || '--' }}
                </div>
              </div>
              <div class="space-y-1">
                <div class="text-[11px] text-slate-500">Forced Sale Value</div>
                <div class="font-medium">
                  {{ security.forcedSaleValue || '--' }}
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="!(securityData?.securities?.length)">
            <div class="text-[11px] text-slate-500">
              No security entries captured yet.
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="border border-blue-100 bg-white p-6 shadow-sm">
      <div class="space-y-5">
        <div class="flex items-center justify-between gap-3 border-b border-blue-100 pb-3">
          <div class="flex items-center gap-2">
            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-blue-600 text-white text-xs">
              <span>06</span>
            </div>
            <div>
              <div class="text-sm font-semibold text-slate-900">
                Document Information
              </div>
              <div class="text-[11px] text-slate-600">
                Uploaded documents and their statuses.
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span
              [ngClass]="getSectionStatusClasses(5)"
            >
              <span class="h-1.5 w-1.5 rounded-full"
                    [class.bg-emerald-500]="completedSteps.includes(5)"
                    [class.bg-amber-400]="!completedSteps.includes(5) && draftSteps.includes(5)"
                    [class.bg-red-500]="!completedSteps.includes(5) && !draftSteps.includes(5)"
              ></span>
              <span>{{ getSectionStatusLabel(5) }}</span>
            </span>
            <app-ui-button
              type="button"
              variant="secondary"
              (click)="onEditSection(5)"
            >
              Edit
            </app-ui-button>
          </div>
        </div>

        <div class="space-y-3 text-xs text-slate-700">
          <div class="overflow-x-auto rounded border border-blue-100 bg-blue-50/40">
            <table class="min-w-full border-collapse text-[11px] text-slate-700">
              <thead>
                <tr class="border-b border-blue-100 bg-blue-50/80 text-slate-600">
                  <th class="px-3 py-2 text-left font-medium whitespace-nowrap">Document Type</th>
                  <th class="px-3 py-2 text-left font-medium whitespace-nowrap">File Name</th>
                  <th class="px-3 py-2 text-left font-medium whitespace-nowrap">File Size</th>
                  <th class="px-3 py-2 text-left font-medium whitespace-nowrap">Status</th>
                  <th class="px-3 py-2 text-left font-medium whitespace-nowrap">Uploaded On</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="let document of documentData?.documents || []"
                  class="border-b border-blue-50 bg-white"
                >
                  <td class="px-3 py-1.5 align-top">
                    {{ document.typeLabel }}
                  </td>
                  <td class="px-3 py-1.5 align-top">
                    {{ document.fileName || '--' }}
                  </td>
                  <td class="px-3 py-1.5 align-top">
                    {{ document.fileSizeBytes ? (document.fileSizeBytes / 1024 | number: '1.0-1') + ' KB' : '--' }}
                  </td>
                  <td class="px-3 py-1.5 align-top">
                    <span class="inline-flex items-center gap-1 rounded-full border border-blue-200 bg-blue-50 px-2 py-0.5 text-[10px] font-semibold text-blue-700">
                      <span class="h-1.5 w-1.5 rounded-full bg-blue-500"></span>
                      <span>{{ document.status || 'Pending' }}</span>
                    </span>
                  </td>
                  <td class="px-3 py-1.5 align-top">
                    {{ document.uploadedAt ? (document.uploadedAt | date: 'medium') : '--' }}
                  </td>
                </tr>
                <tr *ngIf="!(documentData?.documents?.length)">
                  <td
                    class="px-3 py-2 text-slate-500"
                    colspan="5"
                  >
                    No documents uploaded yet.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section class="border border-blue-100 bg-white p-6 shadow-sm">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="space-y-1">
          <div class="text-sm font-semibold text-slate-900">
            Final Confirmation
          </div>
          <div class="text-[11px] text-slate-600">
            By confirming, you submit the complete application for processing. Sections marked
            <span class="inline-flex items-center gap-1 rounded-full bg-red-50 px-1.5 py-0.5 text-[10px] font-semibold text-red-700 border border-red-200">
              <span class="h-1.5 w-1.5 rounded-full bg-red-500"></span>
              Needs Attention
            </span>
            should be reviewed before submission.
          </div>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <app-ui-button
            type="button"
            variant="secondary"
            (click)="goToStep(5)"
          >
            Back to Documents
          </app-ui-button>
          <app-ui-button
            type="button"
            (click)="onConfirmSubmission()"
          >
            Confirm Submission
          </app-ui-button>
        </div>
      </div>
    </section>
  </div>
</app-loms-layout>
