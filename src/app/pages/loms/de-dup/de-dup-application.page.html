<app-loms-layout
  organisationName="Loan Origination and Management System"
  solutionName="LOMS"
  breadcrumb="De-Duplication Search & Finding"
  basePath="/loms"
>
  <div class="space-y-6">
    <section class="border border-blue-100 bg-white p-6 shadow-sm">
      <div class="space-y-2">
        <div>
          <h1 class="text-xl font-semibold text-slate-900">
            {{ title }}
          </h1>
          <p class="text-xs text-slate-500">
            Search for existing customers or applications to prevent duplicates during loan origination.
          </p>
        </div>
      </div>
    </section>

    <section class="border border-blue-100 bg-white p-6 shadow-sm">
      <div class="flex items-start justify-between gap-4 border-b border-blue-50 pb-4">
        <div class="flex items-start gap-2">
          <div class="mt-0.5 flex h-7 w-7 items-center justify-center bg-blue-50 text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="none">
              <path
                d="M5 5h14M8 5v4.5l4 3.5v5"
                stroke="currentColor"
                stroke-width="1.6"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>
          <div>
            <div class="text-sm font-semibold text-slate-900">Search Parameters</div>
            <div class="text-xs text-slate-500">
              Enter customer identity information to check for duplicates.
            </div>
            <div class="mt-1 text-[11px] text-blue-700" *ngIf="activeFiltersCount > 0">
              Filters applied: {{ activeFiltersCount }}.
            </div>
            <div class="mt-1 text-[11px] text-slate-400" *ngIf="activeFiltersCount === 0">
              Tip: enter at least one identity field to narrow down results.
            </div>
          </div>
        </div>
      </div>

      <div class="mt-4 space-y-6">
        <div class="space-y-4">
          <div class="max-w-xs">
            <app-ui-dropdown
              label="Customer Type"
              [required]="true"
              [options]="customerTypeOptions"
              [(value)]="searchParams.customerType"
            ></app-ui-dropdown>
          </div>
          <div class="space-y-2">
            <div class="text-xs font-semibold text-slate-700">
              Individual Identity Parameters
            </div>
            <div class="grid gap-4 md:grid-cols-2">
              <app-ui-input
                label="National ID Number"
                placeholder="Enter 10–17 digit NID"
                [required]="false"
                [(value)]="searchParams.nationalId"
              ></app-ui-input>
              <app-ui-input
                label="Date of Birth"
                placeholder="mm/dd/yyyy"
                [(value)]="searchParams.dateOfBirth"
              ></app-ui-input>
              <app-ui-input
                label="Full Name (as per NID)"
                placeholder="Enter full name"
                [(value)]="searchParams.fullName"
              ></app-ui-input>
              <app-ui-input
                label="Mobile Number"
                placeholder="01XXXXXXXXX"
                [(value)]="searchParams.mobileNumber"
              ></app-ui-input>
              <app-ui-input
                label="TIN Number"
                placeholder="Enter 12-digit TIN"
                [(value)]="searchParams.tinNumber"
              ></app-ui-input>
              <app-ui-input
                label="Passport Number"
                placeholder="Enter passport number"
                [(value)]="searchParams.passportNumber"
              ></app-ui-input>
              <app-ui-input
                label="Father's Name"
                placeholder="Enter father’s name"
                [(value)]="searchParams.fatherName"
              ></app-ui-input>
              <app-ui-input
                label="Mother's Name"
                placeholder="Enter mother’s name"
                [(value)]="searchParams.motherName"
              ></app-ui-input>
            </div>
          </div>
        </div>

        <div class="border border-blue-200 bg-blue-50/40 p-4 space-y-4">
          <div class="flex items-start justify-between gap-4">
            <div class="space-y-1">
              <div class="flex items-center gap-2">
                <div class="flex h-6 w-6 items-center justify-center bg-blue-100 text-blue-700">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-3.5 w-3.5" fill="none">
                    <path
                      d="M12 5v14M5 12h14"
                      stroke="currentColor"
                      stroke-width="1.6"
                      stroke-linecap="round"
                    />
                  </svg>
                </div>
                <div class="text-sm font-semibold text-slate-900">
                  Match Logic Configuration
                </div>
              </div>
              <div class="text-xs text-slate-600">
                Define how entered parameters should be evaluated for duplicate detection.
              </div>
            </div>
          </div>

          <div class="grid gap-3 md:grid-cols-2">
            <button
              type="button"
              class="flex items-start justify-between border px-4 py-3 text-left text-xs"
              [ngClass]="[
                matchLogic === 'AND'
                  ? 'border-blue-500 bg-blue-50'
                  : 'border-slate-200 bg-white'
              ]"
              (click)="matchLogic = 'AND'"
            >
              <div class="flex items-start gap-3">
                <span
                  class="mt-0.5 inline-flex h-4 w-4 items-center justify-center border"
                  [ngClass]="[
                    matchLogic === 'AND'
                      ? 'border-blue-500 bg-blue-500'
                      : 'border-slate-300 bg-white'
                  ]"
                >
                  <span
                    class="h-2 w-2 rounded-full bg-white"
                    *ngIf="matchLogic === 'AND'"
                  ></span>
                </span>
                <div>
                  <div class="text-xs font-semibold text-slate-900">
                    AND Logic
                  </div>
                  <div class="text-[11px] text-slate-600">
                    All parameters must match.
                  </div>
                </div>
              </div>
            </button>

            <button
              type="button"
              class="flex items-start justify-between border px-4 py-3 text-left text-xs"
              [ngClass]="[
                matchLogic === 'OR'
                  ? 'border-blue-500 bg-blue-50'
                  : 'border-slate-200 bg-white'
              ]"
              (click)="matchLogic = 'OR'"
            >
              <div class="flex items-start gap-3">
                <span
                  class="mt-0.5 inline-flex h-4 w-4 items-center justify-center border"
                  [ngClass]="[
                    matchLogic === 'OR'
                      ? 'border-blue-500 bg-blue-500'
                      : 'border-slate-300 bg-white'
                  ]"
                >
                  <span
                    class="h-2 w-2 rounded-full bg-white"
                    *ngIf="matchLogic === 'OR'"
                  ></span>
                </span>
                <div>
                  <div class="text-xs font-semibold text-slate-900">
                    OR Logic
                  </div>
                  <div class="text-[11px] text-slate-600">
                    Any parameter match.
                  </div>
                </div>
              </div>
            </button>
          </div>

          <div class="border border-blue-200 bg-blue-50 px-4 py-3 text-xs text-blue-800">
            <div class="flex items-center gap-2">
              <div class="flex h-5 w-5 items-center justify-center bg-blue-100 text-blue-700">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-3 w-3" fill="none">
                  <path
                    d="M12 5v14M5 12h14"
                    stroke="currentColor"
                    stroke-width="1.6"
                    stroke-linecap="round"
                  />
                </svg>
              </div>
              <div class="font-semibold">
                {{ activeLogicTitle }}
              </div>
            </div>
            <div class="mt-1 text-[11px] text-blue-700">
              {{ activeLogicDescription }}
            </div>
            <div
              class="mt-2 inline-flex flex-wrap items-center gap-1 bg-white/70 px-3 py-1 text-[11px] text-blue-800"
            >
              <span class="font-semibold">Active fields:</span>
              <span class="truncate">
                {{ activeLogicFieldsSummary }}
              </span>
            </div>
          </div>
        </div>

        <div class="flex items-center justify-between gap-3">
          <div class="text-[11px] text-slate-500">
            Adjust parameters above to refine how de-duplication will be performed.
          </div>
          <div class="flex items-center gap-2">
            <app-ui-button
              variant="secondary"
              type="button"
              (click)="resetForm()"
            >
              Reset Form
            </app-ui-button>
            <app-ui-button
              type="button"
              (click)="runSearch()"
            >
              <span class="mr-1 flex h-4 w-4 items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="none">
                  <path
                    d="M11 5a6 6 0 0 1 4.472 9.995l3.266 3.267"
                    stroke="currentColor"
                    stroke-width="1.6"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <circle
                    cx="11"
                    cy="11"
                    r="4.5"
                    stroke="currentColor"
                    stroke-width="1.6"
                  />
                </svg>
              </span>
              <span>Run De-Dup Search</span>
            </app-ui-button>
          </div>
        </div>
      </div>
    </section>

    <section class="border border-blue-100 bg-white p-6 shadow-sm">
      <div class="flex items-start justify-between gap-4 border-b border-blue-50 pb-4">
        <div class="flex items-start gap-2">
          <div class="mt-0.5 flex h-7 w-7 items-center justify-center bg-blue-50 text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="none">
              <path
                d="M5 6h14M5 12h14M5 18h14"
                stroke="currentColor"
                stroke-width="1.6"
                stroke-linecap="round"
              />
            </svg>
          </div>
          <div>
            <div class="text-sm font-semibold text-slate-900">Search Results</div>
            <div class="text-xs text-slate-500">
              Duplicate detection results based on configured match logic.
            </div>
          </div>
        </div>
      </div>

      <div class="mt-3 text-[11px] text-slate-500" *ngIf="!hasSearched">
        Run a de-dup search above to see matching records here.
      </div>

      <div class="mt-4 space-y-4" *ngIf="hasSearched">
        <div class="border border-blue-100 bg-blue-50/40 p-3 text-[11px] text-slate-600">
          <div class="flex flex-wrap items-center justify-between gap-2">
            <div>
              <span class="font-semibold text-slate-800">Configured logic:</span>
              <span class="ml-1 text-blue-700">
                {{ matchLogic === 'AND' ? 'All parameters must match' : 'Any parameter match' }}
              </span>
            </div>
            <div class="text-slate-500">
              Showing {{ filteredResults.length }} result<span *ngIf="filteredResults.length !== 1">s</span>.
            </div>
          </div>
        </div>

        <app-ui-table>
          <thead class="bg-blue-50/60">
            <tr>
              <th class="px-4 py-2 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Full Name
              </th>
              <th class="px-4 py-2 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Customer Code
              </th>
              <th class="px-4 py-2 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Father's Name
              </th>
              <th class="px-4 py-2 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Mother's Name
              </th>
              <th class="px-4 py-2 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Spouse Name
              </th>
              <th class="px-4 py-2 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Product Name
              </th>
              <th class="px-4 py-2 text-right text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Approved Amount
              </th>
              <th class="px-4 py-2 text-center text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Apply Status
              </th>
              <th class="px-4 py-2 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Remarks
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-blue-50">
            <tr
              *ngFor="let row of filteredResults"
              class="cursor-pointer hover:bg-blue-50/60"
              [ngClass]="{
                'bg-blue-50 border-l-4 border-l-blue-500': selectedResultId === row.id
              }"
              (click)="selectResult(row)"
            >
              <td class="px-4 py-2 text-xs text-slate-800">
                {{ row.fullName }}
              </td>
              <td class="px-4 py-2 text-xs text-slate-800">
                {{ row.customerCode }}
              </td>
              <td class="px-4 py-2 text-xs text-slate-800">
                {{ row.fatherName }}
              </td>
              <td class="px-4 py-2 text-xs text-slate-800">
                {{ row.motherName }}
              </td>
              <td class="px-4 py-2 text-xs text-slate-800">
                {{ row.spouseName || '-' }}
              </td>
              <td class="px-4 py-2 text-xs text-slate-800">
                {{ row.productName }}
              </td>
              <td class="px-4 py-2 text-right text-xs font-semibold text-slate-900">
                {{ row.approvedAmount }}
              </td>
              <td class="px-4 py-2 text-center text-xs">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 text-[11px] font-medium"
                  [ngClass]="{
                    'bg-blue-50 text-blue-700': row.applyStatus === 'approved',
                    'bg-sky-50 text-sky-700': row.applyStatus === 'pending',
                    'bg-indigo-50 text-indigo-700': row.applyStatus === 'active'
                  }"
                >
                  {{ row.applyStatus | titlecase }}
                </span>
              </td>
              <td class="px-4 py-2 text-xs text-slate-700">
                {{ row.remarks }}
              </td>
            </tr>
            <tr *ngIf="filteredResults.length === 0">
              <td colspan="9" class="px-4 py-6 text-center text-xs text-slate-500">
                No results found for the selected parameters. Adjust your search and try again.
              </td>
            </tr>
          </tbody>
        </app-ui-table>

        <div class="flex items-center justify-between gap-3 pt-1">
          <div class="text-[11px] text-slate-500">
            Showing {{ filteredResults.length }} result<span *ngIf="filteredResults.length !== 1">s</span>.
            <span *ngIf="selectedResult">
              Selected: {{ selectedResult.fullName }} ({{ selectedResult.customerCode }}).
            </span>
          </div>
          <div class="flex items-center gap-2">
            <app-ui-button
              variant="secondary"
              type="button"
            >
              Export Results
            </app-ui-button>
            <app-ui-button
              type="button"
              [disabled]="!selectedResult"
            >
              <span class="mr-1 flex h-4 w-4 items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="none">
                  <path
                    d="M5 12h14M13 5l7 7-7 7"
                    stroke="currentColor"
                    stroke-width="1.6"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </span>
              <span>Proceed with Selection</span>
            </app-ui-button>
          </div>
        </div>
      </div>
    </section>
  </div>
</app-loms-layout>
