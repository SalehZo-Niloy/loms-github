<app-loms-layout
  organisationName="Loan Origination and Management System"
  solutionName="LOMS"
  [breadcrumb]="breadcrumb"
  basePath="/loms"
>
  <div class="space-y-4">
    <section class="rounded-xl border border-blue-100 bg-white px-6 py-4 shadow-sm">
      <div class="flex flex-col gap-3">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <button
            type="button"
            class="inline-flex h-8 items-center justify-center rounded-md border border-slate-200 bg-white px-3 text-[11px] font-semibold text-slate-700 shadow-sm hover:bg-slate-50"
            (click)="onBackToAssignmentQueue()"
          >
            <span class="mr-1">‚Üê</span>
            <span>Back to CIB Assignment Queue</span>
          </button>
          <div class="flex flex-wrap items-center gap-4 text-[11px]">
            <div class="space-y-0.5">
              <div class="text-slate-500 uppercase tracking-wide">
                Application Reference
              </div>
              <div class="font-semibold text-blue-700">
                {{ selectedPersona?.appId || '‚Äî' }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-slate-500 uppercase tracking-wide">
                Persona Type
              </div>
              <div class="inline-flex items-center rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-semibold text-blue-700">
                {{ selectedPersona?.personaType || '‚Äî' }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-slate-500 uppercase tracking-wide">
                Persona Name
              </div>
              <div class="font-semibold text-slate-900">
                {{ selectedPersona?.fullName || '‚Äî' }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-slate-500 uppercase tracking-wide">
                Current CIB Status
              </div>
              <div
                class="inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold"
                [ngClass]="currentStatusBadgeClasses"
              >
                {{ selectedPersona?.status || 'Not Requested' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-blue-100 bg-white px-6 py-4 shadow-sm">
      <div class="space-y-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <div class="flex h-6 w-6 items-center justify-center rounded bg-blue-50 text-blue-700">
              <span class="text-[12px]">‚ñ§</span>
            </div>
            <div>
              <h2 class="text-xs font-semibold text-slate-900">
                Persona Selection for CIB Details
              </h2>
              <p class="text-[11px] text-slate-500">
                Navigate between personas under this loan application.
              </p>
            </div>
          </div>
        </div>
        <div class="mt-1 overflow-x-auto rounded-md border border-slate-200 bg-white">
          <table class="min-w-full border-separate border-spacing-0 text-[11px]">
            <thead>
              <tr class="bg-slate-50 text-left font-semibold uppercase tracking-wide text-slate-500">
                <th class="px-4 py-2">
                  Persona Type
                </th>
                <th class="px-4 py-2">
                  Full Name
                </th>
                <th class="px-4 py-2">
                  National ID Number
                </th>
                <th class="px-4 py-2">
                  Date of Birth
                </th>
                <th class="px-4 py-2">
                  Mobile Number
                </th>
                <th class="px-4 py-2">
                  CIB Status
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-100 bg-white">
              <tr
                *ngFor="let persona of personas"
                class="text-xs cursor-pointer"
                [class.bg-blue-50]="isRowActive(persona)"
                [class.hover\\:bg-slate-50]="!isRowActive(persona)"
                (click)="setSelectedPersona(persona)"
              >
                <td class="px-4 py-3 align-top text-slate-700">
                  {{ persona.personaType }}
                </td>
                <td class="px-4 py-3 align-top text-slate-900">
                  {{ persona.fullName }}
                </td>
                <td class="px-4 py-3 align-top text-slate-800">
                  {{ persona.nid }}
                </td>
                <td class="px-4 py-3 align-top text-slate-800">
                  {{ persona.dob }}
                </td>
                <td class="px-4 py-3 align-top text-slate-800">
                  {{ persona.mobile }}
                </td>
                <td class="px-4 py-3 align-top">
                  <span
                    class="inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold"
                    [ngClass]="getStatusBadgeClasses(persona.status)"
                  >
                    {{ persona.status }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="grid gap-4 lg:grid-cols-3">
      <div class="space-y-4 lg:col-span-2">
        <section class="rounded-xl border border-blue-100 bg-white px-6 py-4 shadow-sm">
          <div class="space-y-4">
            <div>
              <h2 class="text-xs font-semibold text-slate-900">
                Persona Identity Details
              </h2>
              <p class="text-[11px] text-slate-500">
                Read-only persona information as captured during loan application.
              </p>
            </div>

            <div class="grid gap-4 md:grid-cols-2">
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-600">
                  Full Name (as per NID)
                </div>
                <div class="rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-900">
                  {{ selectedPersona?.fullName || '‚Äî' }}
                </div>
              </div>
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-600">
                  Persona Type
                </div>
                <div class="rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-900">
                  {{ selectedPersona?.personaType || '‚Äî' }}
                </div>
              </div>
            </div>

            <div class="grid gap-4 md:grid-cols-3">
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-600">
                  National ID Number
                </div>
                <div class="rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-900">
                  {{ selectedPersona?.nid || '‚Äî' }}
                </div>
              </div>
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-600">
                  Date of Birth
                </div>
                <div class="rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-900">
                  {{ selectedPersona?.dob || '‚Äî' }}
                </div>
              </div>
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-600">
                  Mobile Number
                </div>
                <div class="rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-900">
                  {{ selectedPersona?.mobile || '‚Äî' }}
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="rounded-xl border border-blue-100 bg-white px-6 py-4 shadow-sm">
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <div class="flex h-6 w-6 items-center justify-center rounded bg-blue-50 text-blue-700">
                  <span class="text-[12px]">üë§</span>
                </div>
                <div>
                  <h2 class="text-xs font-semibold text-slate-900">
                    Officer Assignment / Reassignment
                  </h2>
                  <p class="text-[11px] text-slate-500">
                    Assign or reassign CIB officer for this persona.
                  </p>
                </div>
              </div>
            </div>

            <div class="grid gap-4 md:grid-cols-2">
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-700">
                  Assign / Reassign Officer <span class="text-red-500">*</span>
                </div>
                <select
                  class="h-9 w-full rounded-md border border-slate-200 bg-white px-2 text-[11px] text-slate-700 outline-none ring-0 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
                  [(ngModel)]="assignOfficer"
                  [disabled]="!hasSelection"
                >
                  <option value="">Select CIB Officer</option>
                  <option *ngFor="let o of officers" [value]="o">
                    {{ o }}
                  </option>
                </select>
              </div>
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-700">
                  Priority Level <span class="text-red-500">*</span>
                </div>
                <select
                  class="h-9 w-full rounded-md border border-slate-200 bg-white px-2 text-[11px] text-slate-700 outline-none ring-0 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
                  [(ngModel)]="priority"
                  [disabled]="!hasSelection"
                >
                  <option *ngFor="let p of priorityLevels" [value]="p">
                    {{ p }}
                  </option>
                </select>
              </div>
            </div>

            <div class="grid gap-4 md:grid-cols-2">
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-700">
                  Expected Completion Date <span class="text-red-500">*</span>
                </div>
                <input
                  type="text"
                  class="h-9 w-full rounded-md border border-slate-200 bg-white px-2 text-[11px] text-slate-700 outline-none ring-0 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
                  placeholder="dd-mm-yyyy"
                  [(ngModel)]="expectedCompletionDate"
                  [disabled]="!hasSelection"
                />
              </div>
              <div class="space-y-1">
                <div class="text-[11px] font-medium text-slate-700">
                  Assignment Remarks
                </div>
                <input
                  type="text"
                  class="h-9 w-full rounded-md border border-slate-200 bg-white px-2 text-[11px] text-slate-700 outline-none ring-0 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
                  placeholder="Optional remarks"
                  [(ngModel)]="assignmentRemarks"
                  [disabled]="!hasSelection"
                />
              </div>
            </div>

            <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-end">
              <button
                type="button"
                class="inline-flex h-9 items-center justify-center rounded-md bg-blue-600 px-6 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-500 disabled:hover:bg-slate-200"
                (click)="onAssignOfficer()"
                [disabled]="!canAssign"
              >
                Assign Officer
              </button>
              <button
                type="button"
                class="inline-flex h-9 items-center justify-center rounded-md border border-slate-200 bg-white px-4 text-[11px] font-semibold text-slate-700 shadow-sm hover:bg-slate-50 disabled:bg-slate-100 disabled:text-slate-400"
                (click)="onUpdateAssignment()"
                [disabled]="!canAssign"
              >
                Update Assignment
              </button>
            </div>
          </div>
        </section>
      </div>

      <div class="space-y-4">
        <section class="rounded-xl border border-blue-100 bg-white px-4 py-4 shadow-sm">
          <div class="space-y-3">
            <div>
              <h2 class="text-xs font-semibold text-slate-900">
                CIB Status Timeline
              </h2>
              <p class="text-[11px] text-slate-500">
                End-to-end status for this persona.
              </p>
            </div>
            <ol class="space-y-2 text-[11px]">
              <li
                *ngFor="let item of timelineItems"
                class="flex items-start gap-2"
              >
                <div>
                  <div
                    class="flex h-5 w-5 items-center justify-center rounded-full text-[10px] font-semibold"
                    [ngClass]="{
                      'bg-emerald-500 text-white': item.status === 'done',
                      'bg-blue-500 text-white': item.status === 'active',
                      'bg-slate-200 text-slate-500': item.status === 'pending'
                    }"
                  >
                    <ng-container [ngSwitch]="item.status">
                      <span *ngSwitchCase="'done'">‚úì</span>
                      <span *ngSwitchDefault>‚Ä¢</span>
                    </ng-container>
                  </div>
                </div>
                <div>
                  <div class="font-semibold text-slate-900">
                    {{ item.label }}
                  </div>
                  <div class="text-[11px] text-slate-500">
                    {{ item.description }}
                  </div>
                </div>
              </li>
            </ol>
          </div>
        </section>

        <section class="rounded-xl border border-blue-100 bg-white px-4 py-4 shadow-sm">
          <div class="space-y-3">
            <div>
              <h2 class="text-xs font-semibold text-slate-900">
                Correction Queue
              </h2>
              <p class="text-[11px] text-slate-500">
                Manage and resolve corrections.
              </p>
            </div>
            <div class="space-y-2 text-[11px]">
              <div *ngIf="corrections.length === 0" class="rounded-md border border-emerald-100 bg-emerald-50 px-3 py-2 text-[11px] text-emerald-700">
                No corrections pending for this persona.
              </div>
              <div
                *ngFor="let corr of corrections"
                class="rounded-md border px-3 py-2"
                [ngClass]="{
                  'border-amber-100 bg-amber-50': corr.status === 'Open',
                  'border-emerald-100 bg-emerald-50': corr.status === 'Resolved'
                }"
              >
                <div class="flex items-center justify-between">
                  <span
                    class="inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold"
                    [ngClass]="{
                      'bg-amber-500 text-white': corr.status === 'Open',
                      'bg-emerald-500 text-white': corr.status === 'Resolved'
                    }"
                  >
                    {{ corr.status }}
                  </span>
                  <span class="text-[10px] text-slate-500">
                    {{ corr.date }}
                  </span>
                </div>
                <div class="mt-1 font-semibold text-slate-900">
                  {{ corr.title }}
                </div>
                <div class="text-[10px] text-slate-600">
                  Raised by: {{ corr.raisedBy }}
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>

    <section class="flex flex-col gap-3 rounded-xl border border-blue-100 bg-white px-6 py-3 shadow-sm md:flex-row md:items-center md:justify-between">
      <button
        type="button"
        class="inline-flex h-9 items-center justify-center rounded-md border border-slate-200 bg-white px-4 text-[11px] font-semibold text-slate-700 shadow-sm hover:bg-slate-50"
        (click)="onPrintDetails()"
      >
        Print Details
      </button>
      <div class="flex flex-col gap-3 md:flex-row md:items-center">
        <button
          type="button"
          class="inline-flex h-9 items-center justify-center rounded-md border border-blue-200 bg-blue-50 px-4 text-[11px] font-semibold text-blue-700 shadow-sm hover:bg-blue-100"
          (click)="onViewSubmittedCibData()"
        >
          View Submitted CIB Data
        </button>
        <button
          type="button"
          class="inline-flex h-9 items-center justify-center rounded-md bg-slate-200 px-6 text-[11px] font-semibold text-slate-700 shadow-sm hover:bg-slate-300"
          (click)="onBackToAssignmentQueue()"
        >
          Return to Assignment Queue
        </button>
      </div>
    </section>
  </div>
</app-loms-layout>
