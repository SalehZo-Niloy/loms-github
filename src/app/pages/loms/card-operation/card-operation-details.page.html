<app-loms-layout
  organisationName="Card Issuance System"
  solutionName="LOMS"
  breadcrumb="Application Review Details"
  basePath="/loms"
>
  <div class="px-2 py-4 bg-slate-50 min-h-screen space-y-6 w-full flex-1 max-w-screen-xl mx-auto">
    <section class="flex flex-col gap-3">
      <div class="flex items-center gap-2 text-xs text-slate-500">
        <button
          type="button"
          class="inline-flex items-center gap-2 text-blue-700 font-semibold"
          (click)="onBackToDashboard()"
        >
          <span class="text-base">←</span>
          <span>Back</span>
        </button>
      </div>
      <h1 class="text-2xl font-semibold text-slate-900">
        Application Review Details
      </h1>
    </section>

    <section class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm">
      <div class="flex flex-col gap-4 md:flex-row md:items-start md:justify-between">
        <div class="space-y-3 text-xs">
          <div class="grid grid-cols-1 gap-3 md:grid-cols-2">
            <div>
              <div class="uppercase text-[11px] font-semibold text-slate-500">
                Application ID
              </div>
              <div class="mt-1 text-sm font-semibold text-blue-700">
                {{ application?.id }}
              </div>
            </div>
            <div>
              <div class="uppercase text-[11px] font-semibold text-slate-500">
                Application Date
              </div>
              <div class="mt-1 text-sm font-semibold text-slate-900">
                {{ application?.applicationDate | date: 'dd-MMM-yyyy' }}
              </div>
            </div>
          </div>
          <div class="grid grid-cols-1 gap-3 md:grid-cols-2">
            <div>
              <div class="uppercase text-[11px] font-semibold text-slate-500">
                Customer Name
              </div>
              <div class="mt-1 text-sm font-semibold text-slate-900">
                {{ application?.customerName }}
              </div>
            </div>
            <div>
              <div class="uppercase text-[11px] font-semibold text-slate-500">
                CIF / Customer ID
              </div>
              <div class="mt-1 text-sm font-semibold text-slate-900">
                {{ application?.cif }}
              </div>
            </div>
          </div>
        </div>
        <div class="flex flex-col items-end gap-3 text-[11px] text-slate-500">
          <div class="flex flex-wrap justify-end gap-2">
            <span
              class="inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-semibold"
              [ngClass]="reviewStatusBadgeClasses"
            >
              {{ application?.reviewStatus }}
            </span>
            <span
              class="inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-semibold"
              [ngClass]="priorityBadgeClasses"
            >
              {{ application?.priority }}
            </span>
            <span
              class="inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-semibold"
              [ngClass]="escalationBadgeClasses"
            >
              {{ application?.escalationStatus }}
            </span>
          </div>
          <div class="flex items-center gap-2">
            <button
              type="button"
              class="inline-flex h-8 items-center justify-center rounded-md border border-slate-200 bg-white px-3 text-[11px] font-semibold text-slate-700 hover:bg-slate-50"
            >
              Print
            </button>
            <button
              type="button"
              class="inline-flex h-8 items-center justify-center rounded-md border border-blue-200 bg-blue-50 px-3 text-[11px] font-semibold text-blue-700 hover:bg-blue-100"
            >
              Export
            </button>
          </div>
        </div>
      </div>
    </section>

    <section class="grid gap-4 md:grid-cols-2">
      <div class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm text-xs space-y-3">
        <div class="flex items-center justify-between">
          <h2 class="text-xs font-semibold text-slate-900">
            Customer Information
          </h2>
          <span class="text-[11px] text-slate-400">Primary Cardholder</span>
        </div>
        <div class="grid grid-cols-2 gap-x-6 gap-y-3">
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Customer Name
            </div>
            <div class="mt-1 text-slate-900">
              {{ application?.customerName }}
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              CIF / Customer ID
            </div>
            <div class="mt-1 text-slate-900">
              {{ application?.cif }}
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Mobile Number
            </div>
            <div class="mt-1 text-slate-900">
              +880-1711-234567
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Email ID
            </div>
            <div class="mt-1 text-slate-900">
              customer@example.com
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Customer Segment
            </div>
            <div class="mt-1 text-slate-900">
              Retail Individual
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Branch
            </div>
            <div class="mt-1 text-slate-900">
              {{ application?.branch }}
            </div>
          </div>
        </div>
      </div>

      <div class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm text-xs space-y-3">
        <div class="flex items-center justify-between">
          <h2 class="text-xs font-semibold text-slate-900">
            Account Reference
          </h2>
          <span class="inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-[10px] font-semibold text-blue-700">
            Linked CASA
          </span>
        </div>
        <div class="grid grid-cols-2 gap-x-6 gap-y-3">
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Account Number
            </div>
            <div class="mt-1 text-slate-900">
              {{ application?.accountNumber }}
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Currency
            </div>
            <div class="mt-1 text-slate-900">
              {{ application?.currency }}
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Branch
            </div>
            <div class="mt-1 text-slate-900">
              {{ application?.branch }}
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold text-slate-500">
              Current Balance
            </div>
            <div class="mt-1 text-slate-900">
              BDT 1,250,000.00
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm text-xs space-y-4">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xs font-semibold text-slate-900">
            KYC, Compliance &amp; Risk Snapshot
          </h2>
          <p class="text-[11px] text-slate-500">
            Combined view of KYC completion, screening and risk rating.
          </p>
        </div>
        <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-[10px] font-medium text-slate-700">
          Last refreshed: 08 Feb 2025, 10:30 AM
        </span>
      </div>
      <div class="grid gap-3 md:grid-cols-4">
        <div class="rounded-lg border border-emerald-100 bg-emerald-50/60 px-4 py-3">
          <div class="text-[11px] font-semibold text-emerald-700">
            KYC Status
          </div>
          <div class="mt-2 text-sm font-semibold text-emerald-800">
            {{ kycStatus }}
          </div>
        </div>
        <div class="rounded-lg border border-sky-100 bg-sky-50/60 px-4 py-3">
          <div class="text-[11px] font-semibold text-sky-700">
            AML / Sanctions Screening
          </div>
          <div class="mt-2 text-sm font-semibold text-sky-800">
            {{ amlStatus }}
          </div>
        </div>
        <div class="rounded-lg border border-violet-100 bg-violet-50/60 px-4 py-3">
          <div class="text-[11px] font-semibold text-violet-700">
            Risk Rating
          </div>
          <div class="mt-2 text-sm font-semibold text-violet-800">
            {{ riskRating }}
          </div>
        </div>
        <div class="rounded-lg border border-amber-100 bg-amber-50/60 px-4 py-3">
          <div class="text-[11px] font-semibold text-amber-700">
            Internal Risk Score
          </div>
          <div class="mt-2 text-sm font-semibold text-amber-800">
            {{ riskScore }}
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm text-xs space-y-3">
      <div class="flex items-center justify-between">
        <h2 class="text-xs font-semibold text-slate-900">
          Card Request Details
        </h2>
        <span class="inline-flex items-center rounded-full bg-blue-50 px-3 py-1 text-[10px] font-semibold text-blue-700">
          {{ application?.cardType }} • {{ application?.cardProduct }}
        </span>
      </div>
      <div class="grid grid-cols-2 gap-x-6 gap-y-3">
        <div>
          <div class="text-[11px] font-semibold text-slate-500">
            Requested Card Type
          </div>
          <div class="mt-1 text-slate-900">
            {{ application?.cardType }}
          </div>
        </div>
        <div>
          <div class="text-[11px] font-semibold text-slate-500">
            Requested Card Product
          </div>
          <div class="mt-1 text-slate-900">
            {{ application?.cardProduct }}
          </div>
        </div>
        <div>
          <div class="text-[11px] font-semibold text-slate-500">
            Emboss Name
          </div>
          <div class="mt-1 text-slate-900">
            {{ application?.customerName | uppercase }}
          </div>
        </div>
        <div>
          <div class="text-[11px] font-semibold text-slate-500">
            Usage Type
          </div>
          <div class="mt-1 text-slate-900">
            Domestic &amp; International
          </div>
        </div>
        <div>
          <div class="text-[11px] font-semibold text-slate-500">
            Channel Enablement
          </div>
          <div class="mt-1 text-slate-900">
            POS, ATM, E-commerce
          </div>
        </div>
        <div>
          <div class="text-[11px] font-semibold text-slate-500">
            Requested Limit
          </div>
          <div class="mt-1 text-slate-900">
            {{ application?.currency === 'USD' ? 'USD 5,000.00' : 'BDT 300,000.00' }}
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm text-xs space-y-3">
      <div class="flex items-center justify-between">
        <h2 class="text-xs font-semibold text-slate-900">
          Supplementary Cardholder Information
        </h2>
        <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-[10px] font-medium text-slate-700">
          2 Supplementary Card Requests
        </span>
      </div>
      <div class="grid gap-3 md:grid-cols-2">
        <div class="rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 space-y-1">
          <div class="flex items-center justify-between">
            <div class="text-[11px] font-semibold text-slate-800">
              Ayesha Islam
            </div>
            <span class="inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-semibold text-emerald-700">
              Active
            </span>
          </div>
          <div class="text-[11px] text-slate-600">
            Relationship: Spouse
          </div>
          <div class="text-[11px] text-slate-600">
            Contact: +880-1811-987654
          </div>
        </div>
        <div class="rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 space-y-1">
          <div class="flex items-center justify-between">
            <div class="text-[11px] font-semibold text-slate-800">
              Farhan Rahman
            </div>
            <span class="inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-semibold text-amber-700">
              Pending Activation
            </span>
          </div>
          <div class="text-[11px] text-slate-600">
            Relationship: Son
          </div>
          <div class="text-[11px] text-slate-600">
            Contact: +880-1911-223344
          </div>
        </div>
      </div>
    </section>

    <section class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm text-xs space-y-4">
      <div class="flex flex-col gap-3 md:flex-row md:items-start md:justify-between">
        <div class="flex-1 space-y-3">
          <div>
            <h2 class="text-xs font-semibold text-slate-900">
              Review Notes &amp; Attachments
            </h2>
            <p class="text-[11px] text-slate-500">
              Notes captured during issuance review and uploaded documents.
            </p>
          </div>
          <div class="rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-700">
            Customer profile is in good standing with satisfactory account conduct. KYC and screening results do not
            indicate any adverse findings. Card request aligned with customer income and segment guidelines.
          </div>
          <div class="text-[10px] text-slate-400">
            Last updated by Issuance Reviewer • 08 Feb 2025 11:30 AM
          </div>
        </div>
        <div class="w-full space-y-2 md:w-80">
          <div class="flex items-center justify-between">
            <div class="text-[11px] font-semibold text-slate-800">
              Attached Documents
            </div>
            <span class="text-[10px] text-slate-500">
              {{ attachments.length }} item(s)
            </span>
          </div>
          <div class="space-y-2">
            <div
              *ngFor="let att of attachments"
              class="flex items-center justify-between rounded-md border border-slate-200 bg-white px-3 py-2"
            >
              <div class="space-y-0.5">
                <div class="text-[11px] font-semibold text-slate-800">
                  {{ att.name }}
                </div>
                <div class="text-[10px] text-slate-500">
                  {{ att.type }} • {{ att.size }} • {{ att.uploadedBy }}
                </div>
              </div>
              <div class="flex items-center gap-2 text-[10px]">
                <button
                  type="button"
                  class="text-blue-700 hover:underline"
                  (click)="onDownloadAttachment(att)"
                >
                  Download
                </button>
                <button
                  type="button"
                  class="text-slate-500 hover:underline"
                  (click)="onMarkAsViewed(att)"
                >
                  Mark Viewed
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="grid gap-4 md:grid-cols-[minmax(0,1.2fr)_minmax(0,0.9fr)]">
      <div class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm text-xs space-y-3">
        <div class="flex items-center justify-between">
          <h2 class="text-xs font-semibold text-slate-900">
            Reviewer Action
          </h2>
          <span class="text-[10px] text-slate-500">
            Capture final decision and remarks.
          </span>
        </div>
        <div class="space-y-2">
          <div class="text-[11px] font-semibold text-slate-700">
            Reviewer Remarks
          </div>
          <textarea
            rows="4"
            class="w-full rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-300"
            [(ngModel)]="reviewerRemarks"
            placeholder="Enter detailed review notes, risk observations and any conditions for approval."
          ></textarea>
        </div>
        <div class="space-y-3">
          <div class="space-y-1">
            <div class="text-[11px] font-semibold text-slate-700">
              Decision
            </div>
            <div class="flex flex-wrap items-center gap-2 text-[11px] text-slate-700">
              <label class="inline-flex items-center gap-1">
                <input
                  type="radio"
                  class="h-3 w-3 text-blue-600"
                  name="decision"
                  [value]="'approve'"
                  [(ngModel)]="decision"
                />
                <span>Approve</span>
              </label>
              <label class="inline-flex items-center gap-1">
                <input
                  type="radio"
                  class="h-3 w-3 text-blue-600"
                  name="decision"
                  [value]="'sendBack'"
                  [(ngModel)]="decision"
                />
                <span>Hold Application</span>
              </label>
              <label class="inline-flex items-center gap-1">
                <input
                  type="radio"
                  class="h-3 w-3 text-blue-600"
                  name="decision"
                  [value]="'reject'"
                  [(ngModel)]="decision"
                />
                <span>Reject</span>
              </label>
              <label class="inline-flex items-center gap-1">
                <input
                  type="radio"
                  class="h-3 w-3 text-blue-600"
                  name="decision"
                  [value]="'escalate'"
                  [(ngModel)]="decision"
                />
                <span>Escalate Forward</span>
              </label>
            </div>
          </div>
          <div class="space-y-3">
            <div class="text-[11px] font-semibold text-slate-700">
              Additional Flags
            </div>
            <div class="space-y-4 text-[11px] text-slate-700">
              <label class="flex items-center gap-2">
                <input
                  type="checkbox"
                  class="h-3 w-3 text-blue-600"
                  [(ngModel)]="markPriorityAsUrgent"
                />
                <span>Priority as Urgent</span>
              </label>

              <label class="flex items-center gap-2">
                <input
                  type="checkbox"
                  class="h-3 w-3 text-blue-600"
                  [(ngModel)]="markForEscalation"
                />
                <span>Mark for Escalation to Maker</span>
              </label>
            </div>
          </div>
        </div>
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="text-[10px] text-slate-500">
            Changes here update the application header and timeline on this screen.
          </div>
          <div class="flex flex-wrap items-center gap-2">
            <button
              type="button"
              class="inline-flex items-center rounded-md border border-slate-200 bg-white px-4 py-2 text-[11px] font-medium text-slate-700 hover:bg-slate-50"
            >
              Save Draft
            </button>
            <button
              type="button"
              class="inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-[11px] font-semibold text-white hover:bg-blue-700 disabled:bg-slate-300 disabled:text-slate-600"
              [disabled]="decisionDisabled"
              (click)="onSubmitDecision()"
            >
              Submit Reviewer Action
            </button>
          </div>
        </div>
      </div>

      <div class="rounded-xl border border-slate-200 bg-white px-5 py-4 shadow-sm text-xs space-y-3">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-xs font-semibold text-slate-900">
              Application Timeline
            </h2>
            <p class="text-[11px] text-slate-500">
              End-to-end status for this card issuance request.
            </p>
          </div>
        </div>
        <ol class="space-y-2 text-[11px]">
          <li
            *ngFor="let item of timelineItems"
            class="flex items-start gap-2"
          >
            <div>
              <div
                class="flex h-5 w-5 items-center justify-center rounded-full text-[10px] font-semibold"
                [ngClass]="timelineBadgeClasses(item)"
              >
                <ng-container [ngSwitch]="item.status">
                  <span *ngSwitchCase="'done'">✓</span>
                  <span *ngSwitchDefault>•</span>
                </ng-container>
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="font-semibold text-slate-900">
                {{ item.label }}
              </div>
              <div class="text-[11px] text-slate-500">
                {{ item.description }}
              </div>
              <div class="text-[10px] text-slate-400">
                {{ item.time }}
              </div>
            </div>
          </li>
        </ol>
      </div>
    </section>
  </div>
</app-loms-layout>
