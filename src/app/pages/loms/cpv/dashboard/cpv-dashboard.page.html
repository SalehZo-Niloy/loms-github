<app-loms-layout
  organisationName="Loan Origination and Monitoring System"
  solutionName="LOMS"
  breadcrumb="CPV Dashboard"
  basePath="/loms"
>
  <div class="space-y-6">
    <section class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <div class="space-y-1">
        <h1 class="text-lg font-semibold text-slate-900">
          CPV Dashboard
        </h1>
        <p class="text-sm text-slate-600">
          Loan Origination and Monitoring System
        </p>
      </div>
      <!-- <div class="text-right text-[11px] text-slate-500 space-y-0.5">
        <div>
          RM: Rafiqul Islam
        </div>
        <div>
          Branch: Gulshan Corporate
        </div>
        <div>
          11:37:58
        </div>
      </div> -->
    </section>

    <section class="rounded-md border border-slate-200 bg-white p-5 text-xs shadow-sm space-y-4">
      <div class="grid gap-4 md:grid-cols-[minmax(0,2.2fr)_minmax(0,1.2fr)_minmax(0,1.2fr)_auto] items-end">
        <div class="space-y-1">
          <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
            Search Application ID
          </div>
          <div class="relative">
            <span
              class="pointer-events-none absolute left-2.5 top-1/2 -translate-y-1/2 text-[11px] text-slate-400"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-3.5 w-3.5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="m15.5 15.5 4 4"
                />
                <circle
                  cx="11"
                  cy="11"
                  r="5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                />
              </svg>
            </span>
            <input
              type="text"
              class="h-10 w-full rounded-md border border-slate-200 bg-white pl-7 pr-3 text-[13px] text-slate-700 outline-none ring-0 placeholder:text-slate-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
              placeholder="Enter Application ID"
              [(ngModel)]="searchApplicationId"
              (ngModelChange)="onFilterChange()"
            />
          </div>
        </div>

        <div class="space-y-1">
          <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
            CPV Status
          </div>
          <select
            class="h-10 w-full rounded-md border border-slate-200 bg-white px-3 text-[13px] text-slate-700 outline-none ring-0 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
            [(ngModel)]="cpvStatusFilter"
            (ngModelChange)="onFilterChange()"
          >
            <option *ngFor="let status of cpvStatusOptions" [ngValue]="status">
              {{ status }}
            </option>
          </select>
        </div>

        <div class="space-y-1">
          <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
            Loan Type
          </div>
          <select
            class="h-10 w-full rounded-md border border-slate-200 bg-white px-3 text-[13px] text-slate-700 outline-none ring-0 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
            [(ngModel)]="loanTypeFilter"
            (ngModelChange)="onFilterChange()"
          >
            <option *ngFor="let type of loanTypeOptions" [ngValue]="type">
              {{ type }}
            </option>
          </select>
        </div>

        <!-- <div class="flex md:justify-end">
          <button
            type="button"
            class="inline-flex h-10 items-center justify-center rounded-md bg-blue-600 px-5 text-[13px] font-semibold text-white shadow-sm hover:bg-blue-700"
            (click)="applyFilters()"
          >
            Apply Filters
          </button>
        </div> -->
      </div>
    </section>

    <section class="rounded-md border border-slate-200 bg-white p-5 text-xs shadow-sm">
      <div class="flex items-center justify-between gap-3">
        <div>
          <h2 class="text-sm font-semibold text-slate-900">
            CPV Applications
          </h2>
        </div>
        <div class="text-[11px] text-slate-500">
          Total: {{ totalApplications }} applications
        </div>
      </div>

      <div class="mt-4 overflow-x-auto">
        <app-ui-table>
          <thead class="bg-slate-50">
            <tr class="text-left text-[11px] font-semibold uppercase tracking-wide text-slate-500">
              <th class="px-4 py-2">
                Application ID
              </th>
              <th class="px-4 py-2">
                Applicant Name
              </th>
              <th class="px-4 py-2">
                Loan Type
              </th>
              <th class="px-4 py-2">
                Requested Loan Amount
              </th>
              <th class="px-4 py-2">
                CPV Status
              </th>
              <!-- <th class="px-4 py-2">
                Actions
              </th> -->
              <th class="px-4 py-2 text-right">
                Status
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100 bg-white">
            <tr
              *ngFor="let row of displayedApplications"
              class="text-xs hover:bg-slate-50"
            >
              <td class="px-4 py-3 font-semibold text-blue-700">
                <button
                  type="button"
                  class="text-[11px] font-semibold text-blue-700 hover:underline"
                  (click)="openApplicationDetails(row)"
                >
                  {{ row.applicationId }}
                </button>
              </td>
              <td class="px-4 py-3 text-[11px] text-slate-900">
                {{ row.applicantName }}
              </td>
              <td class="px-4 py-3 text-[11px] text-slate-700">
                {{ row.loanType }}
              </td>
              <td class="px-4 py-3 text-[11px] text-slate-900">
                {{ row.requestedLoanAmount }}
              </td>
              <td class="px-4 py-3">
                <span
                  class="inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold"
                  [ngClass]="cpvStatusClasses(row.cpvStatus)"
                >
                  {{ row.cpvStatus }}
                </span>
              </td>
              <!-- <td class="px-4 py-3 text-[11px] text-blue-700">
                <button
                  type="button"
                  class="font-semibold text-blue-700 hover:underline"
                >
                  View Details
                </button>
              </td> -->
              <td class="px-4 py-3 text-right">
                <button
                  type="button"
                  class="inline-flex items-center rounded px-3 py-1 text-[11px] font-semibold disabled:cursor-not-allowed disabled:opacity-60"
                  [disabled]="row.statusLabel !== 'CPV Initiation'"
                  [ngClass]="getStatusButtonClasses(row.statusLabel)"
                  (click)="navigateToCpvInitiation(row)"
                >
                  {{ row.statusLabel }}
                </button>
              </td>
            </tr>
          </tbody>
        </app-ui-table>
      </div>

      <!-- <div class="mt-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
        <div class="text-[11px] text-slate-500">
          Showing {{ showingFrom }} to {{ showingTo }} of {{ totalApplications }} results
        </div>
        <div class="flex items-center justify-end gap-1 text-[11px]">
          <button
            type="button"
            class="rounded-md border border-slate-200 bg-white px-3 py-1 text-slate-600"
          >
            Previous
          </button>
          <button
            type="button"
            class="rounded-md border border-blue-600 bg-blue-600 px-3 py-1 text-white"
          >
            1
          </button>
          <button
            type="button"
            class="rounded-md border border-slate-200 bg-white px-3 py-1 text-slate-600"
          >
            2
          </button>
          <button
            type="button"
            class="rounded-md border border-slate-200 bg-white px-3 py-1 text-slate-600"
          >
            3
          </button>
          <button
            type="button"
            class="rounded-md border border-slate-200 bg-white px-3 py-1 text-slate-600"
          >
            Next
          </button>
        </div>
      </div> -->
    </section>
  </div>

  <app-ui-modal
    [open]="showApplicationModal"
    title="Application Details"
    size="lg"
    (close)="closeApplicationModal()"
  >
    <ng-container *ngIf="selectedApplication as app">
      <div class="space-y-6">
        <section class="space-y-3">
          <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
            Application Information
          </div>
          <div class="grid gap-y-4 gap-x-10 text-[11px] text-slate-700 md:grid-cols-3">
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Application ID
              </div>
              <div class="font-semibold text-slate-900">
                {{ app.applicationId }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Application Date
              </div>
              <div>
                {{ app.applicationDate }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Application Status
              </div>
              <div>
                {{ app.applicationStatus }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Originating Branch
              </div>
              <div>
                {{ app.originatingBranch }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Relationship Manager
              </div>
              <div>
                {{ app.relationshipManager }}
              </div>
            </div>
          </div>
        </section>

        <section class="space-y-3">
          <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
            Applicant Information
          </div>
          <div class="grid gap-y-4 gap-x-10 text-[11px] text-slate-700 md:grid-cols-3">
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Applicant Name
              </div>
              <div class="font-semibold text-slate-900">
                {{ app.applicantName }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                National ID Number
              </div>
              <div>
                {{ app.nationalIdNumber }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Mobile Number
              </div>
              <div>
                {{ app.mobileNumber }}
              </div>
            </div>
            <div class="space-y-0.5 md:col-span-3">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Present Address
              </div>
              <div>
                {{ app.presentAddress }}
              </div>
            </div>
          </div>
        </section>

        <section class="space-y-3">
          <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
            Loan Information
          </div>
          <div class="grid gap-y-4 gap-x-10 text-[11px] text-slate-700 md:grid-cols-3">
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Loan Type
              </div>
              <div>
                {{ app.loanType }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Product Name
              </div>
              <div>
                {{ app.productName }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Requested Loan Amount
              </div>
              <div>
                {{ app.requestedLoanAmount }}
              </div>
            </div>
            <div class="space-y-0.5">
              <div class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">
                Loan Tenure
              </div>
              <div>
                {{ app.loanTenure }}
              </div>
            </div>
          </div>
        </section>

        <!-- <div class="flex justify-end pt-2">
          <button
            type="button"
            class="rounded-md border border-slate-200 bg-slate-50 px-4 py-2 text-xs font-medium text-slate-700 hover:bg-slate-100"
            (click)="closeApplicationModal()"
          >
            Close
          </button>
        </div> -->
      </div>
    </ng-container>
  </app-ui-modal>
</app-loms-layout>
